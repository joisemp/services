<!-- Activity History Section -->
<section id="activity-history" class="mt-4">
  <div class="card">
    <div class="card-header bg-light">
      <h5 class="card-title mb-0">
        <i class="fas fa-history me-2"></i>
        Activity History
        <span class="badge bg-secondary ms-2">{{ activities.count }}</span>
      </h5>
    </div>
    <div class="card-body p-0">
      {% if activities %}
        <div class="activity-timeline p-3">
          {% for activity in activities %}
          <div class="activity-item d-flex mb-3 pb-3 {% if not forloop.last %}border-bottom{% endif %}">
            <!-- Activity Icon -->
            <div class="activity-icon me-3 flex-shrink-0">
              {% if activity.activity_type == 'created' %}
                <span class="badge bg-success rounded-circle p-2">
                  <i class="fas fa-plus"></i>
                </span>
              {% elif activity.activity_type == 'status_changed' or activity.activity_type == 'resolved' or activity.activity_type == 'closed' or activity.activity_type == 'cancelled' or activity.activity_type == 'escalated' %}
                <span class="badge bg-info rounded-circle p-2">
                  <i class="fas fa-exchange-alt"></i>
                </span>
              {% elif activity.activity_type == 'reopened' %}
                <span class="badge bg-warning rounded-circle p-2">
                  <i class="fas fa-redo"></i>
                </span>
              {% elif activity.activity_type == 'assigned' or activity.activity_type == 'reassigned' or activity.activity_type == 'unassigned' %}
                <span class="badge bg-primary rounded-circle p-2">
                  <i class="fas fa-user"></i>
                </span>
              {% elif activity.activity_type == 'priority_changed' %}
                <span class="badge bg-warning rounded-circle p-2">
                  <i class="fas fa-flag"></i>
                </span>
              {% elif activity.activity_type == 'work_task_created' or activity.activity_type == 'work_task_updated' %}
                <span class="badge bg-secondary rounded-circle p-2">
                  <i class="fas fa-tasks"></i>
                </span>
              {% elif activity.activity_type == 'work_task_completed' %}
                <span class="badge bg-success rounded-circle p-2">
                  <i class="fas fa-check"></i>
                </span>
              {% elif activity.activity_type == 'work_task_reopened' %}
                <span class="badge bg-warning rounded-circle p-2">
                  <i class="fas fa-undo"></i>
                </span>
              {% elif activity.activity_type == 'work_task_deleted' %}
                <span class="badge bg-danger rounded-circle p-2">
                  <i class="fas fa-trash"></i>
                </span>
              {% elif activity.activity_type == 'site_visit_created' or activity.activity_type == 'site_visit_updated' %}
                <span class="badge bg-info rounded-circle p-2">
                  <i class="fas fa-map-marker-alt"></i>
                </span>
              {% elif activity.activity_type == 'site_visit_completed' %}
                <span class="badge bg-success rounded-circle p-2">
                  <i class="fas fa-check-circle"></i>
                </span>
              {% elif activity.activity_type == 'site_visit_cancelled' %}
                <span class="badge bg-danger rounded-circle p-2">
                  <i class="fas fa-times-circle"></i>
                </span>
              {% elif activity.activity_type == 'purchase_request_created' %}
                <span class="badge bg-info rounded-circle p-2">
                  <i class="fas fa-shopping-cart"></i>
                </span>
              {% elif activity.activity_type == 'purchase_request_approved' %}
                <span class="badge bg-success rounded-circle p-2">
                  <i class="fas fa-check-circle"></i>
                </span>
              {% elif activity.activity_type == 'purchase_request_rejected' %}
                <span class="badge bg-danger rounded-circle p-2">
                  <i class="fas fa-times-circle"></i>
                </span>
              {% elif activity.activity_type == 'purchase_request_deleted' %}
                <span class="badge bg-danger rounded-circle p-2">
                  <i class="fas fa-trash"></i>
                </span>
              {% elif activity.activity_type == 'image_added' or activity.activity_type == 'image_deleted' %}
                <span class="badge bg-secondary rounded-circle p-2">
                  <i class="fas fa-image"></i>
                </span>
              {% elif activity.activity_type == 'voice_added' or activity.activity_type == 'voice_deleted' %}
                <span class="badge bg-secondary rounded-circle p-2">
                  <i class="fas fa-microphone"></i>
                </span>
              {% elif activity.activity_type == 'review_requested' or activity.activity_type == 'reviewed' %}
                <span class="badge bg-primary rounded-circle p-2">
                  <i class="fas fa-clipboard-check"></i>
                </span>
              {% elif activity.activity_type == 'updated' %}
                <span class="badge bg-secondary rounded-circle p-2">
                  <i class="fas fa-edit"></i>
                </span>
              {% else %}
                <span class="badge bg-secondary rounded-circle p-2">
                  <i class="fas fa-circle"></i>
                </span>
              {% endif %}
            </div>
            
            <!-- Activity Details -->
            <div class="activity-details flex-grow-1">
              <div class="activity-header d-flex justify-content-between align-items-start flex-wrap">
                <div class="activity-info mb-1">
                  <strong class="activity-type">{{ activity.get_activity_type_display }}</strong>
                  <span class="text-muted small">
                    by 
                    {% if activity.user %}
                      {{ activity.user.get_full_name|default:activity.user.email|default:activity.user.phone_number }}
                    {% else %}
                      System
                    {% endif %}
                  </span>
                </div>
                <small class="text-muted">
                  <i class="fas fa-clock me-1"></i>
                  {{ activity.created_at|date:"M d, Y g:i A" }}
                </small>
              </div>
              
              <p class="activity-description mb-0 text-muted">
                {{ activity.description }}
              </p>
              
              <!-- Show old and new values if available -->
              {% if activity.old_value or activity.new_value %}
                <div class="activity-changes mt-2 small">
                  {% if activity.old_value %}
                    <span class="badge bg-light text-dark me-2">
                      <i class="fas fa-minus-circle text-danger me-1"></i>
                      {{ activity.old_value }}
                    </span>
                  {% endif %}
                  {% if activity.new_value %}
                    <span class="badge bg-light text-dark">
                      <i class="fas fa-plus-circle text-success me-1"></i>
                      {{ activity.new_value }}
                    </span>
                  {% endif %}
                </div>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center text-muted py-4">
          <i class="fas fa-history fa-3x mb-3 opacity-50"></i>
          <p class="mb-0">No activity history yet</p>
        </div>
      {% endif %}
    </div>
  </div>
</section>
