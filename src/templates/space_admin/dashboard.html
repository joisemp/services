{% extends 'sidebar_base.html' %}

{% block title %}Space Admin Dashboard{% endblock %}

{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'styles/dashboard/space_admin/style.css' %}">
{% endblock %}

{% block navbar %}
{% include 'navbar.html' %}
{% endblock %}

{% block sidebar %}
{% include 'space_admin/sidebar.html' %}
{% endblock %}

{% block content %}

<section id="heading" class="mt-2">
    <div class="alert alert-notification alert-primary" role="alert">
        <h5 class="mb-1">Welcome back {{ request.user.first_name|default:request.user.get_short_name }}</h5>
        <p class="mb-0">Here's what's happening across the spaces you manage.</p>
    </div>
</section>

<section id="summary" class="mt-4">
    <div class="row g-3">
        {% for card in summary_cards %}
            <div class="col-12 col-sm-6 col-lg-4 col-xxl-3">
                <div class="card h-100 border-0">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <p class="text-muted small mb-1">{{ card.label }}</p>
                            <h4 class="fw-semibold mb-0">{{ card.value }}</h4>
                        </div>
                        <span class="material-symbols-outlined fs-2 text-{{ card.variant }}">{{ card.icon }}</span>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</section>

<section id="stats" class="mt-4">
    <div>
        <div class="card-body">
            <div style="width: 100%; height: 320px;">
                <canvas id="dashboardChart" aria-label="Issue trend chart" role="img"></canvas>
            </div>
        </div>
    </div>
</section>


<section id="space-issue-cards" class="mt-4">
    <div class="title-recent-issues d-flex justify-content-between align-items-center">
        <h3 class="mb-1">Recent Issues</h3>
        <a href="{{ view_all_issues_url }}" class="btn btn-primary btn-sm d-flex align-items-center">
            <span>View All</span>
            <span class="material-symbols-outlined ms-2" style="font-size: 16px;">arrow_forward_ios</span>
        </a>
    </div>
    <div class="container-fluid px-0 mt-3">
        {% if recent_issues %}
            <div class="row row-cols-1 row-cols-lg-2 row-cols-xxl-3 g-3">
                {% for issue in recent_issues %}
                    <div class="col">
                        <a href="{{ issue.url }}" class="text-decoration-none card-link-wrapper">
                            <div class="card h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <h5 class="card-title mb-0">{{ issue.title }}</h5>
                                        <span class="badge {{ issue.priority_class }} rounded-pill text-uppercase">{{ issue.priority_display }}</span>
                                    </div>
                                    <hr>
                                    <div class="d-flex justify-content-between text-muted small mb-2">
                                        <span>{{ issue.created_at|date:"M j, Y" }}</span>
                                        <span>{{ issue.created_at|time:"H:i" }}</span>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mt-3">
                                        <div>
                                            <p class="mb-1 text-muted small">Reporter</p>
                                            <p class="mb-0 fw-semibold">{{ issue.reporter }}</p>
                                        </div>
                                        <span class="badge {{ issue.status_class }} rounded-pill">{{ issue.status_display }}</span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-light border mt-3" role="alert">
                No issues have been reported for your spaces yet. They'll show up here once activity starts.
            </div>
        {% endif %}
    </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{{ chart_config|json_script:"dashboard-chart-config" }}
<script>
    const chartCanvas = document.getElementById('dashboardChart');
    const chartDataElement = document.getElementById('dashboard-chart-config');
    if (chartCanvas && chartDataElement) {
        const chartConfig = JSON.parse(chartDataElement.textContent);
        new Chart(chartCanvas, chartConfig);
    }
</script>

{% endblock %}